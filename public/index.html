<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sangeet - A Music Hub</title>
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Spotify_logo_without_text.svg/1200px-Spotify_logo_without_text.svg.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --spotify-green: #1DB954;
            --dark-bg: #121212;
            --dark-card: #181818;
            --dark-text: #b3b3b3;
            --light-text: #fff;
            --sidebar-width: 250px;
            --player-height: 90px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--dark-bg);
            color: var(--light-text);
            display: flex;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #000;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #282828;
            position: fixed;
            height: 100%;
            overflow-y: auto;
            z-index: 1001;
            transform: translateX(0);
            transition: transform 0.3s ease-in-out;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar .logo {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--spotify-green);
            margin-bottom: 30px;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav ul li {
            margin-bottom: 15px;
        }

        .sidebar nav ul li a {
            color: var(--dark-text);
            text-decoration: none;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            padding: 8px 0;
            transition: color 0.2s ease;
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a.active {
            color: var(--light-text);
        }

        .sidebar nav ul li a i {
            margin-right: 10px;
            font-size: 1.3em;
        }

        /* Main Content */
        .main-content-wrapper {
            flex-grow: 1;
            margin-left: var(--sidebar-width);
            padding-bottom: var(--player-height);
            overflow-y: auto;
            max-height: calc(100vh - var(--player-height));
            box-sizing: border-box;
        }

        .main-content {
            padding: 20px 40px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            background-color: var(--dark-bg);
            z-index: 100;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            width: 100%;
            max-width: 400px;
        }

        .search-bar input {
            flex-grow: 1;
            padding: 12px 15px;
            border-radius: 50px;
            border: none;
            background-color: #2a2a2a;
            color: var(--light-text);
            font-size: 1em;
            outline: none;
        }

        .search-bar button {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            background-color: var(--spotify-green);
            color: var(--light-text);
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s ease;
        }

        .search-bar button:hover {
            background-color: #1ed760;
        }

        .user-actions {
            display: flex;
            gap: 15px;
        }
        
        .user-actions .admin-link,
        .user-actions .profile-btn {
            padding: 10px 15px;
            border-radius: 50px;
            background-color: #555;
            color: var(--light-text);
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 700;
            transition: background-color 0.2s ease;
        }
        .user-actions .admin-link:hover,
        .user-actions .profile-btn:hover {
            background-color: #777;
        }
        
        .hamburger-menu {
            display: none;
            font-size: 1.5em;
            cursor: pointer;
            margin-right: 20px;
            color: var(--light-text);
        }


        h2 {
            font-size: 2em;
            margin-bottom: 25px;
            color: var(--light-text);
        }

        .content-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        /* Song List Grid */
        .song-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .song-item {
            background-color: var(--dark-card);
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            position: relative;
        }

        .song-item:hover {
            background-color: #282828;
            transform: translateY(-5px);
        }

        .song-item img {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .add-to-playlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 1.2em;
            cursor: pointer;
            z-index: 10;
        }

        .song-title {
            font-size: 1.1em;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--light-text);
        }

        .song-channel {
            font-size: 0.9em;
            color: var(--dark-text);
            margin-top: 5px;
        }
        
        /* Playlist View */
        .playlist-item {
            display: flex;
            align-items: center;
            background-color: var(--dark-card);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-bottom: 10px;
        }
        .playlist-item:hover {
            background-color: #282828;
        }
        .playlist-item img {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            margin-right: 15px;
        }
        .playlist-item .info {
            flex-grow: 1;
        }
        .playlist-item .title {
            font-weight: 700;
        }
        .playlist-item .count {
            font-size: 0.9em;
            color: var(--dark-text);
        }

        /* Player Bar */
        #player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--player-height);
            background-color: #282828;
            border-top: 1px solid #000;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            justify-content: space-between;
            z-index: 1000;
        }

        .player-left {
            display: flex;
            align-items: center;
            width: 30%;
        }

        .player-left img {
            width: 60px;
            height: 60px;
            border-radius: 4px;
            margin-right: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .player-info .current-song-title {
            font-size: 1.1em;
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .player-info .current-song-artist {
            font-size: 0.9em;
            color: var(--dark-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .player-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 40%;
            gap: 8px;
        }

        .player-controls button {
            background: none;
            border: none;
            color: var(--light-text);
            font-size: 1.5em;
            margin: 0 10px;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .player-controls button:hover {
            color: var(--spotify-green);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #404040;
            height: 4px;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--spotify-green);
            border-radius: 2px;
            transition: width 0.1s linear;
        }

        .progress-time {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 0.8em;
            color: var(--dark-text);
            margin-top: 5px;
        }

        .player-right {
            width: 30%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 15px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-control input[type="range"] {
            width: 100px;
            -webkit-appearance: none;
            height: 4px;
            background: #404040;
            border-radius: 2px;
            outline: none;
        }
        .volume-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--spotify-green);
            cursor: pointer;
        }

        #player-iframe {
            display: none;
        }

        /* Modal for Playlists */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease-in-out;
        }

        .modal.visible {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            color: var(--light-text);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-header .close-btn {
            background: none;
            border: none;
            color: var(--dark-text);
            font-size: 1.5em;
            cursor: pointer;
        }

        .playlist-list-modal {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .playlist-list-modal button {
            display: block;
            width: 100%;
            padding: 10px;
            background: none;
            border: 1px solid #333;
            color: var(--light-text);
            text-align: left;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
        }

        .playlist-list-modal button:hover {
            background-color: #282828;
        }

        .new-playlist-form {
            display: flex;
            gap: 10px;
        }

        .new-playlist-form input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #333;
            background-color: #2a2a2a;
            color: var(--light-text);
        }

        .new-playlist-form button {
            padding: 8px 15px;
            border-radius: 4px;
            border: none;
            background-color: var(--spotify-green);
            color: var(--light-text);
            cursor: pointer;
        }

        /* User Authentication View */
        #auth-view {
            display: none;
            padding: 40px;
            text-align: center;
        }
        #auth-form {
            background-color: var(--dark-card);
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            margin: auto;
        }
        #auth-form h3 {
            margin-top: 0;
        }
        #auth-form input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #333;
            background-color: #2a2a2a;
            color: var(--light-text);
            border-radius: 4px;
        }
        #auth-form button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            background-color: var(--spotify-green);
            color: var(--light-text);
            font-weight: 700;
            cursor: pointer;
        }
        #auth-form p {
            font-size: 0.9em;
            margin-top: 15px;
            color: var(--dark-text);
        }
        #auth-form a {
            color: var(--spotify-green);
            cursor: pointer;
        }


        /* Admin Panel Styling */
        #admin-section {
            display: none;
            padding: 20px 40px;
            margin-top: 20px;
        }

        #admin-login-form, #admin-content {
            background-color: var(--dark-card);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            max-width: 500px;
            margin: 30px auto;
        }

        #admin-login-form input {
            width: calc(100% - 30px);
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #333;
            background-color: #2a2a2a;
            color: var(--light-text);
            font-size: 1em;
            outline: none;
        }

        #admin-login-btn {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: none;
            background-color: var(--spotify-green);
            color: var(--light-text);
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #admin-login-btn:hover {
            background-color: #1ed760;
        }

        #admin-message {
            color: #ff4d4d;
            margin-top: 10px;
            text-align: center;
        }

        #admin-content h3 {
            margin-top: 0;
            color: var(--light-text);
            font-size: 1.5em;
        }

        #admin-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #admin-content th, #admin-content td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
            text-align: left;
            color: var(--dark-text);
        }
        #admin-content th {
            color: var(--light-text);
            font-weight: 700;
        }

        #admin-content button {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            background-color: #555;
            color: var(--light-text);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #admin-content button:hover {
            background-color: #777;
        }

        /* Font Awesome for Icons */
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css');

        /* --- MEDIA QUERIES FOR MOBILE --- */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 200px;
                --player-height: 80px;
            }

            body {
                flex-direction: column;
                overflow-y: auto;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                z-index: 1002;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content-wrapper {
                margin-left: 0;
                padding-bottom: var(--player-height);
                max-height: none;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
                position: static;
                margin-bottom: 10px;
            }
            
            .hamburger-menu {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1003;
                background-color: rgba(0, 0, 0, 0.5);
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .search-bar {
                margin-top: 20px;
                width: 100%;
                max-width: none;
            }

            .user-actions {
                display: none;
            }

            .main-content {
                padding: 10px 20px;
            }

            h2 {
                font-size: 1.5em;
            }

            .song-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }

            .song-item {
                padding: 10px;
            }

            .song-title {
                font-size: 1em;
            }

            /* Player Bar Mobile adjustments */
            #player-bar {
                height: auto;
                flex-direction: column;
                padding: 10px;
                border-top: none;
                justify-content: center;
                gap: 10px;
            }

            .player-left, .player-center, .player-right {
                width: 100%;
                justify-content: center;
                text-align: center;
            }
            
            .player-left {
                margin-bottom: 10px;
            }

            .player-left img {
                display: none;
            }

            .player-info {
                max-width: 100%;
                text-align: center;
            }

            .player-info .current-song-title, .player-info .current-song-artist {
                white-space: normal;
                overflow: visible;
                text-overflow: clip;
                max-width: none;
            }

            .player-controls button {
                font-size: 1.2em;
                margin: 0 5px;
            }

            .progress-bar-container {
                display: none;
            }

            .progress-time {
                justify-content: center;
                gap: 15px;
                margin-top: 0;
            }

            .volume-control {
                display: none;
            }

            /* Admin Panel Mobile adjustments */
            #admin-login-form, #admin-content {
                padding: 15px;
                margin: 20px 10px;
            }

            #admin-content table {
                font-size: 0.8em;
            }

            #admin-content th, #admin-content td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="hamburger-menu" id="hamburger-menu">
        <i class="fas fa-bars"></i>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="logo">Sangeet</div>
        <nav>
            <ul>
                <li><a href="#" id="home-nav" class="active"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#" id="search-nav"><i class="fas fa-search"></i> Search</a></li>
                <li><a href="#" id="library-nav"><i class="fas fa-grip-lines"></i> Your Library</a></li>
                <li><a href="#" id="auth-nav"><i class="fas fa-user-circle"></i> Profile</a></li>
                <li><a href="#admin-section" id="admin-nav"><i class="fas fa-user-shield"></i> Admin Panel</a></li>
            </ul>
        </nav>
    </div>

    <div class="main-content-wrapper">
        <div class="main-content" id="home-view">
            <header>
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="Search for songs...">
                    <button id="search-button">Search</button>
                </div>
                <div class="user-actions">
                    <button class="profile-btn" id="header-auth-btn"><i class="fas fa-user-circle"></i> Login</button>
                </div>
            </header>
            
            <h2 id="current-view-title">Home</h2>
            
            <div id="home-sections">
                <div class="content-section" id="recently-played-section">
                    <h3 class="section-title">Recently Played</h3>
                    <div id="recently-played-songs" class="song-list">
                        <p style="color: var(--dark-text);">No songs played recently. Start listening!</p>
                    </div>
                </div>

                <div class="content-section" id="popular-songs-section">
                    <h3 class="section-title">Popular Songs</h3>
                    <div id="popular-songs" class="song-list">
                        <p style="text-align: center;">Loading popular songs...</p>
                    </div>
                </div>

                <div class="content-section" id="random-songs-section">
                    <h3 class="section-title">Explore</h3>
                    <div id="random-songs" class="song-list">
                        <p style="text-align: center;">Loading songs...</p>
                    </div>
                </div>
            </div>

            <div id="search-view" style="display: none;">
                 <div id="search-results" class="song-list">
                    <p style="text-align: center; margin-top: 50px; color: var(--dark-text);">Use the search bar above to find songs.</p>
                 </div>
            </div>
        </div>

        <div id="auth-view">
            <h2>User Profile</h2>
            <div id="auth-form">
                <h3 id="auth-form-title">Login</h3>
                <input type="email" id="auth-email" placeholder="Email">
                <input type="password" id="auth-password" placeholder="Password">
                <button id="auth-submit-btn">Login</button>
                <p id="auth-message" style="color: #ff4d4d;"></p>
                <p><a href="#" id="toggle-auth">Don't have an account? Sign Up</a></p>
            </div>
        </div>

        <div id="library-view" class="main-content" style="display: none;">
            <h2>Your Library</h2>
            <div id="playlists-container">
                <h3>Your Playlists</h3>
                <div id="playlist-list">
                    <p style="color: var(--dark-text);">You haven't created any playlists yet.</p>
                </div>
                <div class="new-playlist-form" style="margin-top: 20px;">
                    <input type="text" id="new-playlist-name" placeholder="New Playlist Name">
                    <button id="create-playlist-btn">Create</button>
                </div>
            </div>

            <div id="playlist-details" style="display: none; margin-top: 40px;">
                <h3 id="playlist-details-title"></h3>
                <div id="playlist-details-songs" class="song-list">
                </div>
            </div>
        </div>

        <div id="admin-section">
            <h2>Admin Dashboard</h2>
            <div id="admin-login-form">
                <input type="email" id="admin-email" placeholder="Admin Email" value="mymaruf94@gmail.com">
                <input type="password" id="admin-password" placeholder="Password">
                <button id="admin-login-btn">Login</button>
                <p id="admin-message"></p>
            </div>
            <div id="admin-content" style="display: none;">
                <h3>User List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="user-list">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="player-bar">
        <div class="player-left">
            <img id="player-thumbnail" src="https://via.placeholder.com/60" alt="Song Thumbnail">
            <div class="player-info">
                <div class="current-song-title" id="player-current-title">No song playing</div>
                <div class="current-song-artist" id="player-current-artist">Unknown Artist</div>
            </div>
        </div>
        <div class="player-center">
            <div class="player-controls">
                <button><i class="fas fa-backward"></i></button>
                <button id="play-pause-btn"><i class="fas fa-play"></i></button>
                <button><i class="fas fa-forward"></i></button>
            </div>
            <div class="progress-bar-container" id="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-time">
                <span id="current-time">0:00</span>
                <span id="total-time">0:00</span>
            </div>
        </div>
        <div class="player-right">
            <div class="volume-control">
                <i class="fas fa-volume-up"></i>
                <input type="range" id="volume-slider" min="0" max="100" value="100">
            </div>
            <div id="player-iframe"></div>
        </div>
    </div>

    <div id="playlist-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add to Playlist</h3>
                <button class="close-btn" id="close-modal-btn">&times;</button>
            </div>
            <div id="playlist-modal-list" class="playlist-list-modal">
            </div>
            <div class="new-playlist-form">
                <input type="text" id="modal-new-playlist-name" placeholder="New Playlist">
                <button id="modal-create-playlist-btn">Create</button>
            </div>
        </div>
    </div>


<script>
    const songsContainer = document.getElementById('songs-container');
    const searchInput = document.getElementById('search-input');
    const searchButton = document.getElementById('search-button');

    const playerThumbnail = document.getElementById('player-thumbnail');
    const playerCurrentTitle = document.getElementById('player-current-title');
    const playerCurrentArtist = document.getElementById('player-current-artist');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const progressBarContainer = document.getElementById('progress-bar-container');
    const progressBar = document.getElementById('progress-bar');
    const currentTimeSpan = document.getElementById('current-time');
    const totalTimeSpan = document.getElementById('total-time');
    const volumeSlider = document.getElementById('volume-slider');

    const homeView = document.getElementById('home-view');
    const libraryView = document.getElementById('library-view');
    const adminSection = document.getElementById('admin-section');
    const authView = document.getElementById('auth-view');
    const currentViewTitle = document.getElementById('current-view-title');

    const adminLoginForm = document.getElementById('admin-login-form');
    const adminContent = document.getElementById('admin-content');
    const adminLoginBtn = document.getElementById('admin-login-btn');
    const adminEmailInput = document.getElementById('admin-email');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminMessage = document.getElementById('admin-message');
    const userListTable = document.getElementById('user-list');

    // Navigation links
    const homeNav = document.getElementById('home-nav');
    const searchNav = document.getElementById('search-nav');
    const libraryNav = document.getElementById('library-nav');
    const adminNav = document.getElementById('admin-nav');
    const authNav = document.getElementById('auth-nav');

    // Mobile specific elements
    const sidebar = document.getElementById('sidebar');
    const hamburgerMenu = document.getElementById('hamburger-menu');

    // Home view sections
    const homeSections = document.getElementById('home-sections');
    const searchView = document.getElementById('search-view');
    const recentlyPlayedSongs = document.getElementById('recently-played-songs');
    const popularSongs = document.getElementById('popular-songs');
    const randomSongs = document.getElementById('random-songs');
    const searchResults = document.getElementById('search-results');
    
    // Auth elements
    const authFormTitle = document.getElementById('auth-form-title');
    const authSubmitBtn = document.getElementById('auth-submit-btn');
    const toggleAuthLink = document.getElementById('toggle-auth');
    const headerAuthBtn = document.getElementById('header-auth-btn');

    // Playlist elements
    const playlistModal = document.getElementById('playlist-modal');
    const playlistModalList = document.getElementById('playlist-modal-list');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalNewPlaylistNameInput = document.getElementById('modal-new-playlist-name');
    const modalCreatePlaylistBtn = document.getElementById('modal-create-playlist-btn');
    const playlistListContainer = document.getElementById('playlist-list');
    const newPlaylistNameInput = document.getElementById('new-playlist-name');
    const createPlaylistBtn = document.getElementById('create-playlist-btn');
    const playlistDetailsContainer = document.getElementById('playlist-details');
    const playlistDetailsTitle = document.getElementById('playlist-details-title');
    const playlistDetailsSongs = document.getElementById('playlist-details-songs');


    const BASE_URL = 'https://video-hub-s3g2.onrender.com';

    let player;
    let currentVideoId = null;
    let currentVideoDuration = 0;
    let playerReady = false;
    let loggedInUser = null; // Stores logged-in user info
    let currentSongToAdd = null; // Stores the song ID to add to a playlist

    // Store user data in a simple, temporary object
    const users = {
        "user@example.com": { email: "user@example.com", password: "password123", playlists: [] }
    };

    // Store recently played and popular songs
    let recentlyPlayedList = [];
    const popularList = [];

    // --- YouTube IFrame Player API ---
    function onYouTubeIframeAPIReady() {
        playerReady = true;
    }

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // --- Utility Functions ---
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
    }

    function updateProgressBar() {
        if (player && player.getPlayerState) {
            const currentTime = player.getCurrentTime();
            const duration = player.getDuration();
            currentVideoDuration = duration;
            const progress = (currentTime / duration) * 100;
            progressBar.style.width = `${progress}%`;
            currentTimeSpan.textContent = formatTime(currentTime);
            totalTimeSpan.textContent = formatTime(duration);

            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                requestAnimationFrame(updateProgressBar);
            }
        }
    }

    // --- Song Display and Playback ---
    async function fetchSongs(url, container, title) {
        container.innerHTML = '<p style="text-align: center; margin-top: 20px;">Loading songs...</p>';
        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data.success) {
                renderSongs(data.data, container);
            } else {
                container.innerHTML = `<p style="text-align: center; margin-top: 20px; color: #ff4d4d;">${data.message}</p>`;
            }
        } catch (error) {
            container.innerHTML = '<p style="text-align: center; margin-top: 20px; color: #ff4d4d;">Failed to load songs. Please check server or network.</p>';
            console.error(error);
        }
    }

    function renderSongs(songs, container) {
        container.innerHTML = '';
        if (songs.length === 0) {
            container.innerHTML = '<p style="text-align: center; margin-top: 20px; color: var(--dark-text);">No songs found.</p>';
            return;
        }
        songs.forEach(song => {
            const songItem = document.createElement('div');
            songItem.className = 'song-item';
            songItem.innerHTML = `
                <img src="${song.thumbnail}" alt="${song.title}">
                <div class="song-title">${song.title}</div>
                <div class="song-channel">${song.channel}</div>
                <button class="add-to-playlist-btn" data-song-id="${song.id}" data-song-title="${song.title}" data-song-channel="${song.channel}" data-song-thumbnail="${song.thumbnail}"><i class="fas fa-plus-circle"></i></button>
            `;
            songItem.addEventListener('click', (e) => {
                if (!e.target.closest('.add-to-playlist-btn')) {
                     playSong(song.id, song.title, song.channel, song.thumbnail);
                }
            });
            container.appendChild(songItem);
        });

        document.querySelectorAll('.add-to-playlist-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const song = {
                    id: e.currentTarget.dataset.songId,
                    title: e.currentTarget.dataset.songTitle,
                    channel: e.currentTarget.dataset.songChannel,
                    thumbnail: e.currentTarget.dataset.songThumbnail
                };
                openPlaylistModal(song);
            });
        });
    }

    function playSong(videoId, title, artist, thumbnail) {
        if (!playerReady) {
            console.error("YouTube Player API not ready.");
            return;
        }

        const song = { id: videoId, title, artist, thumbnail };
        
        // Add to recently played
        const existingIndex = recentlyPlayedList.findIndex(s => s.id === song.id);
        if (existingIndex !== -1) {
            recentlyPlayedList.splice(existingIndex, 1);
        }
        recentlyPlayedList.unshift(song);
        if (recentlyPlayedList.length > 10) {
            recentlyPlayedList.pop();
        }
        renderSongs(recentlyPlayedList, recentlyPlayedSongs);


        currentVideoId = videoId;
        playerCurrentTitle.textContent = title;
        playerCurrentArtist.textContent = artist || 'Unknown Artist';
        playerThumbnail.src = thumbnail || 'https://via.placeholder.com/60';
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';

        if (!player) {
            player = new YT.Player('player-iframe', {
                height: '0',
                width: '0',
                videoId: videoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'modestbranding': 1,
                    'enablejsapi': 1,
                    'iv_load_policy': 3,
                    'autoplay': 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        } else {
            player.loadVideoById(videoId);
        }
    }

    function onPlayerReady(event) {
        event.target.playVideo();
        volumeSlider.value = event.target.getVolume();
        requestAnimationFrame(updateProgressBar);
    }

    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.PLAYING) {
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            requestAnimationFrame(updateProgressBar);
        } else {
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        }
        if (event.data === YT.PlayerState.ENDED) {
            playerCurrentTitle.textContent = 'No song playing';
            playerCurrentArtist.textContent = 'Unknown Artist';
            playerThumbnail.src = 'https://via.placeholder.com/60';
            progressBar.style.width = '0%';
            currentTimeSpan.textContent = '0:00';
            totalTimeSpan.textContent = '0:00';
        }
    }

    function onPlayerError(event) {
        console.error('YouTube Player Error:', event.data);
        playerCurrentTitle.textContent = 'Error playing song';
        playerCurrentArtist.textContent = 'Please try another.';
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
    }


    // --- Event Listeners ---
    searchButton.addEventListener('click', () => {
        const query = searchInput.value;
        if (query) {
            hideAllViews();
            homeView.style.display = 'block';
            homeSections.style.display = 'none';
            searchView.style.display = 'block';
            currentViewTitle.textContent = `Search results for "${query}"`;
            fetchSongs(`${BASE_URL}/api/songs/search?query=${encodeURIComponent(query)}`, searchResults, 'Search Results');
            searchNav.classList.add('active');
        }
    });

    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            searchButton.click();
        }
    });

    playPauseBtn.addEventListener('click', () => {
        if (!player || !player.getPlayerState) return;
        const playerState = player.getPlayerState();
        if (playerState === YT.PlayerState.PLAYING) {
            player.pauseVideo();
        } else {
            player.playVideo();
        }
    });

    volumeSlider.addEventListener('input', () => {
        if (player && player.setVolume) {
            player.setVolume(volumeSlider.value);
        }
    });

    progressBarContainer.addEventListener('click', (e) => {
        if (!player || !player.seekTo || currentVideoDuration === 0) return;
        const clickX = e.clientX - progressBarContainer.getBoundingClientRect().left;
        const percentage = clickX / progressBarContainer.offsetWidth;
        const seekTime = currentVideoDuration * percentage;
        player.seekTo(seekTime, true);
    });
    
    // --- Mobile Navigation ---
    hamburgerMenu.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    function closeSidebar() {
        if (window.innerWidth <= 768) {
            sidebar.classList.remove('active');
        }
    }
    
    // --- Navigation ---
    function hideAllViews() {
        homeView.style.display = 'none';
        adminSection.style.display = 'none';
        libraryView.style.display = 'none';
        authView.style.display = 'none';
        document.querySelectorAll('.sidebar nav ul li a').forEach(link => {
            link.classList.remove('active');
        });
    }

    homeNav.addEventListener('click', (e) => {
        e.preventDefault();
        hideAllViews();
        homeView.style.display = 'block';
        homeSections.style.display = 'block';
        searchView.style.display = 'none';
        currentViewTitle.textContent = 'Home';
        homeNav.classList.add('active');
        fetchInitialData();
        closeSidebar();
    });

    searchNav.addEventListener('click', (e) => {
        e.preventDefault();
        hideAllViews();
        homeView.style.display = 'block';
        homeSections.style.display = 'none';
        searchView.style.display = 'block';
        searchNav.classList.add('active');
        currentViewTitle.textContent = 'Search for Music';
        searchResults.innerHTML = '<p style="text-align: center; margin-top: 50px; color: var(--dark-text);">Use the search bar above to find songs.</p>';
        searchInput.focus();
        closeSidebar();
    });

    libraryNav.addEventListener('click', (e) => {
        e.preventDefault();
        hideAllViews();
        libraryView.style.display = 'block';
        libraryNav.classList.add('active');
        if (loggedInUser) {
            renderPlaylists();
        } else {
            playlistListContainer.innerHTML = '<p style="color: var(--dark-text);">You must be logged in to view your library.</p>';
        }
        closeSidebar();
    });

    adminNav.addEventListener('click', (e) => {
        e.preventDefault();
        hideAllViews();
        adminSection.style.display = 'block';
        adminNav.classList.add('active');
        closeSidebar();
    });

    authNav.addEventListener('click', (e) => {
        e.preventDefault();
        hideAllViews();
        authView.style.display = 'block';
        authNav.classList.add('active');
        closeSidebar();
    });
    
    headerAuthBtn.addEventListener('click', (e) => {
        e.preventDefault();
        authNav.click();
    });

    // --- User Authentication ---
    let isLogin = true;
    toggleAuthLink.addEventListener('click', (e) => {
        e.preventDefault();
        isLogin = !isLogin;
        authFormTitle.textContent = isLogin ? 'Login' : 'Sign Up';
        authSubmitBtn.textContent = isLogin ? 'Login' : 'Sign Up';
        toggleAuthLink.textContent = isLogin ? "Don't have an account? Sign Up" : "Already have an account? Login";
        document.getElementById('auth-message').textContent = '';
    });

    authSubmitBtn.addEventListener('click', () => {
        const email = document.getElementById('auth-email').value;
        const password = document.getElementById('auth-password').value;
        const messageEl = document.getElementById('auth-message');

        if (isLogin) {
            // Login logic
            if (users[email] && users[email].password === password) {
                loggedInUser = users[email];
                messageEl.textContent = 'Login successful!';
                messageEl.style.color = var(--spotify-green);
                headerAuthBtn.textContent = `Hello, ${email.split('@')[0]}`;
                authNav.innerHTML = `<i class="fas fa-user-circle"></i> Logged In`;
            } else {
                messageEl.textContent = 'Invalid email or password.';
                messageEl.style.color = '#ff4d4d';
            }
        } else {
            // Sign up logic
            if (users[email]) {
                messageEl.textContent = 'Email already exists. Please login.';
                messageEl.style.color = '#ff4d4d';
            } else {
                users[email] = { email, password, playlists: [] };
                messageEl.textContent = 'Sign up successful! Please login.';
                messageEl.style.color = var(--spotify-green);
                isLogin = true;
                authFormTitle.textContent = 'Login';
                authSubmitBtn.textContent = 'Login';
                toggleAuthLink.textContent = "Don't have an account? Sign Up";
            }
        }
    });

    // --- Playlists ---
    function openPlaylistModal(song) {
        if (!loggedInUser) {
            alert('Please log in to add songs to a playlist.');
            return;
        }
        currentSongToAdd = song;
        renderPlaylistsInModal();
        playlistModal.classList.add('visible');
    }

    closeModalBtn.addEventListener('click', () => {
        playlistModal.classList.remove('visible');
    });

    window.addEventListener('click', (e) => {
        if (e.target === playlistModal) {
            playlistModal.classList.remove('visible');
        }
    });

    function renderPlaylistsInModal() {
        playlistModalList.innerHTML = '';
        if (loggedInUser.playlists.length === 0) {
            playlistModalList.innerHTML = '<p>No playlists found. Create one below.</p>';
        } else {
            loggedInUser.playlists.forEach(playlist => {
                const button = document.createElement('button');
                button.textContent = `${playlist.name} (${playlist.songs.length})`;
                button.addEventListener('click', () => {
                    addSongToPlaylist(playlist.id, currentSongToAdd);
                    playlistModal.classList.remove('visible');
                });
                playlistModalList.appendChild(button);
            });
        }
    }

    modalCreatePlaylistBtn.addEventListener('click', () => {
        const name = modalNewPlaylistNameInput.value.trim();
        if (name) {
            createPlaylist(name);
            modalNewPlaylistNameInput.value = '';
        }
    });

    createPlaylistBtn.addEventListener('click', () => {
        const name = newPlaylistNameInput.value.trim();
        if (name) {
            createPlaylist(name);
            newPlaylistNameInput.value = '';
        }
    });

    function createPlaylist(name) {
        if (!loggedInUser) {
            alert('You must be logged in to create a playlist.');
            return;
        }
        const newPlaylist = {
            id: Date.now().toString(),
            name: name,
            songs: []
        };
        loggedInUser.playlists.push(newPlaylist);
        renderPlaylists();
        renderPlaylistsInModal();
    }

    function addSongToPlaylist(playlistId, song) {
        const playlist = loggedInUser.playlists.find(p => p.id === playlistId);
        if (playlist) {
            const isDuplicate = playlist.songs.some(s => s.id === song.id);
            if (!isDuplicate) {
                playlist.songs.push(song);
                alert(`Song added to "${playlist.name}".`);
            } else {
                alert('This song is already in this playlist.');
            }
        }
    }

    function renderPlaylists() {
        playlistListContainer.innerHTML = '';
        if (loggedInUser.playlists.length === 0) {
            playlistListContainer.innerHTML = '<p style="color: var(--dark-text);">You haven\'t created any playlists yet.</p>';
        } else {
            loggedInUser.playlists.forEach(playlist => {
                const playlistItem = document.createElement('div');
                playlistItem.className = 'playlist-item';
                playlistItem.innerHTML = `
                    <img src="https://via.placeholder.com/60?text=Playlist" alt="Playlist Cover">
                    <div class="info">
                        <div class="title">${playlist.name}</div>
                        <div class="count">${playlist.songs.length} songs</div>
                    </div>
                `;
                playlistItem.addEventListener('click', () => viewPlaylist(playlist));
                playlistListContainer.appendChild(playlistItem);
            });
        }
        playlistDetailsContainer.style.display = 'none';
    }

    function viewPlaylist(playlist) {
        playlistDetailsContainer.style.display = 'block';
        playlistDetailsTitle.textContent = playlist.name;
        renderSongs(playlist.songs, playlistDetailsSongs);
    }

    // --- Initial Data Fetch ---
    async function fetchInitialData() {
        // Fetch popular songs (placeholder for a real API)
        const popularUrl = `${BASE_URL}/api/songs/random?count=5`;
        fetchSongs(popularUrl, popularSongs, 'Popular Songs');
        
        // Fetch random songs for the 'Explore' section
        const randomUrl = `${BASE_URL}/api/songs/random?count=10`;
        fetchSongs(randomUrl, randomSongs, 'Explore');

        // Render recently played songs
        if (recentlyPlayedList.length > 0) {
            renderSongs(recentlyPlayedList, recentlyPlayedSongs);
        } else {
            recentlyPlayedSongs.innerHTML = '<p style="color: var(--dark-text);">No songs played recently. Start listening!</p>';
        }
    }


    // --- Admin Panel Logic ---
    adminLoginBtn.addEventListener('click', async () => {
        const email = adminEmailInput.value;
        const password = adminPasswordInput.value;

        try {
            const response = await fetch(`${BASE_URL}/admin/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();
            if (data.success) {
                adminLoginForm.style.display = 'none';
                adminContent.style.display = 'block';
                fetchUserList();
            } else {
                adminMessage.textContent = 'Invalid credentials!';
            }
        } catch (error) {
            adminMessage.textContent = 'Login failed. Server unreachable?';
            console.error(error);
        }
    });

    async function fetchUserList() {
        try {
            const response = await fetch(`${BASE_URL}/admin/users`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminEmailInput.value}`
                }
            });
            const data = await response.json();
            if (data.success) {
                renderUserList(data.users);
            } else {
                adminMessage.textContent = data.message || 'Failed to fetch user list.';
            }
        } catch (error) {
            adminMessage.textContent = 'Failed to fetch user list. Server unreachable?';
            console.error(error);
        }
    }

    function renderUserList(users) {
        userListTable.innerHTML = '';
        users.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${user.email}</td>
                <td>${user.status}</td>
                <td>
                    <button onclick="updateUserStatus('${user.email}', '${user.status === 'active' ? 'blocked' : 'active'}')">
                        ${user.status === 'active' ? 'Block' : 'Unblock'}
                    </button>
                </td>
            `;
            userListTable.appendChild(row);
        });
    }

    async function updateUserStatus(email, newStatus) {
        try {
            const response = await fetch(`${BASE_URL}/admin/user/status`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminEmailInput.value}`
                },
                body: JSON.stringify({ email, status: newStatus })
            });
            const data = await response.json();
            if (data.success) {
                alert(data.message);
                fetchUserList(); 
            } else {
                alert(data.message);
            }
        } catch (error) {
            alert('Failed to update user status. Server unreachable?');
            console.error(error);
        }
    }

    // Initial load
    window.onload = () => {
        fetchInitialData();
    };
</script>

</body>
</html>