<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Web</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .song-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .song-card { width: 250px; border: 1px solid #ccc; padding: 10px; text-align: center; cursor: pointer; }
        .song-card img { width: 100%; height: 150px; object-fit: cover; }
        #search-box { margin-bottom: 20px; }
        #search-results { margin-top: 20px; }
        .audio-player { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>My Song Web</h1>

    <div id="search-box">
        <input type="text" id="searchInput" placeholder="Search for a song...">
        <button onclick="searchSongs()">Search</button>
    </div>

    <div id="search-results" class="song-container" style="display: none;"></div>

    <div id="homepage" class="song-container"></div>

    <div class="audio-player">
        <h3>Now Playing: <span id="songTitle"></span></h3>
        <audio id="audioElement" controls></audio>
    </div>

    <script>
        // Replace with your Render/Vercel backend URL
        const BACKEND_URL = 'https://video-hub-s3g2.onrender.com'; 

        document.addEventListener('DOMContentLoaded', fetchRandomSongs);

        async function fetchRandomSongs() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/random-songs`);
                const songs = await response.json();
                displaySongs(songs, 'homepage');
            } catch (error) {
                console.error('Failed to load random songs:', error);
            }
        }

        async function searchSongs() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            try {
                const response = await fetch(`${BACKEND_URL}/api/search?query=${encodeURIComponent(query)}`);
                const songs = await response.json();
                displaySongs(songs, 'search-results');
                document.getElementById('homepage').style.display = 'none';
                document.getElementById('search-results').style.display = 'flex';
            } catch (error) {
                console.error('Failed to search songs:', error);
            }
        }

        function displaySongs(songs, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            songs.forEach(song => {
                const card = document.createElement('div');
                card.className = 'song-card';
                card.innerHTML = `
                    <img src="${song.thumbnail}" alt="${song.title}">
                    <p>${song.title}</p>
                `;
                card.onclick = () => playSong(song);
                container.appendChild(card);
            });
        }

        async function playSong(song) {
            const audio = document.getElementById('audioElement');
            const songTitle = document.getElementById('songTitle');
            try {
                const response = await fetch(`${BACKEND_URL}/api/audio?videoId=${song.id}`);
                const data = await response.json();
                if (data.downloadLink) {
                    audio.src = data.downloadLink;
                    songTitle.textContent = song.title;
                    audio.play();
                } else {
                    console.error('No download link found.');
                }
            } catch (error) {
                console.error('Error playing song:', error);
            }
        }
    </script>
</body>
</html>