<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMM Music Hub</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            background-color: #121212;
            color: white;
            padding-bottom: 70px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            color: #1db954;
        }
        .header a {
            color: white;
            text-decoration: none;
        }
        .search-form {
            text-align: center;
            margin-bottom: 30px;
        }
        .search-input {
            width: 70%;
            max-width: 500px;
            padding: 12px;
            border: none;
            border-radius: 25px;
            background-color: #333;
            color: white;
            font-size: 16px;
        }
        .search-button {
            padding: 12px 25px;
            background-color: #1db954;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
        }
        .search-button:hover {
            background-color: #1ed760;
        }
        .section-title {
            font-size: 1.5em;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
        .card {
            background-color: #282828;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        .card:hover {
            background-color: #404040;
        }
        .card img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .card .title {
            font-size: 1em;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .card .subtitle {
            font-size: 0.8em;
            color: #b3b3b3;
            margin-top: 5px;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background-color: #282828;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
            padding: 10px 0;
            z-index: 1000;
        }
        .nav-item {
            text-align: center;
        }
        .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #b3b3b3;
            font-size: 14px;
            font-weight: bold;
        }
        .nav-link.active {
            color: white;
        }
        .nav-link:hover {
            color: white;
        }
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .hidden {
            display: none;
        }

        #mini-player-bar {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 600px;
            background-color: #282828;
            color: white;
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            cursor: pointer;
            transition: bottom 0.3s ease-in-out;
        }
        #mini-player-bar.hidden {
            bottom: -100px;
        }
        #mini-player-bar .album-art-mini {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin-right: 15px;
        }
        #mini-player-bar .song-info-mini {
            flex-grow: 1;
        }
        #mini-player-bar .song-title-mini {
            font-size: 0.9em;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #mini-player-bar .song-artist-mini {
            font-size: 0.7em;
            color: #b3b3b3;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #mini-player-bar .play-button-mini {
            font-size: 1.5em;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            margin-left: 10px;
        }

        #fullscreen-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #535353, #121212);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            padding: 20px;
            box-sizing: border-box;
        }
        #fullscreen-player .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
        }
        #fullscreen-player .album-art-full {
            width: 80%;
            max-width: 350px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }
        #fullscreen-player .song-title-full {
            font-size: 1.8em;
            font-weight: bold;
            margin: 0 0 5px;
        }
        #fullscreen-player .song-artist-full {
            font-size: 1.2em;
            color: #ccc;
            margin: 0;
        }
        #fullscreen-player .progress-bar-container {
            width: 90%;
            max-width: 400px;
            height: 5px;
            background-color: #555;
            border-radius: 5px;
            margin-top: 20px;
        }
        #fullscreen-player .progress-fill {
            height: 100%;
            background-color: #1db954;
            border-radius: 5px;
            transition: width 0.1s linear;
        }
        #fullscreen-player .time-display {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 400px;
            color: #ccc;
            font-size: 0.9em;
            margin-top: 5px;
        }
        #fullscreen-player .player-controls-full {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 30px;
        }
        #fullscreen-player .control-button {
            background: none;
            border: none;
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            margin: 0 15px;
        }
        #fullscreen-player .control-button.large {
            font-size: 4em;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>SMM Music Hub</h1>
        </div>

        <div id="home-section">
            <h2 class="section-title">Categories</h2>
            <div id="category-grid" class="grid"></div>
            
            <h2 class="section-title">Your Top Mixes</h2>
            <div id="mixes-grid" class="grid"></div>
        </div>

        <div id="search-section" class="hidden">
            <h2 class="section-title">Search for Music</h2>
            <div class="search-form">
                <input type="text" class="search-input" id="music-search-input" placeholder="What do you want to listen to?">
                <button class="search-button" id="music-search-button">Search</button>
            </div>
            <div id="search-results-grid" class="grid"></div>
        </div>
    </div>

    <div id="mini-player-bar" class="hidden">
        <img id="mini-album-art" class="album-art-mini" src="" alt="Album Art">
        <div class="song-info-mini">
            <div id="mini-song-title" class="song-title-mini"></div>
            <div id="mini-song-artist" class="song-artist-mini"></div>
        </div>
        <button id="mini-play-pause-button" class="play-button-mini">‚ñ∂</button>
    </div>

    <div id="fullscreen-player" class="hidden">
        <button class="back-button" id="full-player-back-button">·ê∏</button>
        <img id="full-album-art" class="album-art-full" src="" alt="Album Art">
        <h3 id="full-song-title" class="song-title-full"></h3>
        <p id="full-song-artist" class="song-artist-full"></p>
        <div class="progress-bar-container">
            <div id="full-progress-fill" class="progress-fill"></div>
        </div>
        <div class="time-display">
            <span id="full-current-time">0:00</span>
            <span id="full-total-time">0:00</span>
        </div>
        <div class="player-controls-full">
            <button class="control-button">‚èÆ</button>
            <button id="full-play-pause-button" class="control-button large">‚ñ∂</button>
            <button class="control-button">‚è≠</button>
        </div>
        <audio id="audio-player" style="display: none;"></audio>
    </div>

    <div class="bottom-nav">
        <div class="nav-item">
            <a href="#" class="nav-link active" id="home-nav-link">
                <span class="nav-icon">üè†</span>
                Home
            </a>
        </div>
        <div class="nav-item">
            <a href="#" class="nav-link" id="search-nav-link">
                <span class="nav-icon">üîç</span>
                Search
            </a>
        </div>
        <div class="nav-item">
            <a href="#" class="nav-link" id="library-nav-link">
                <span class="nav-icon">üìö</span>
                Your Library
            </a>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const homeSection = document.getElementById('home-section');
        const searchSection = document.getElementById('search-section');
        const categoryGrid = document.getElementById('category-grid');
        const mixesGrid = document.getElementById('mixes-grid');
        const searchInput = document.getElementById('music-search-input');
        const searchButton = document.getElementById('music-search-button');
        const searchResultsGrid = document.getElementById('search-results-grid');
        
        const miniPlayerBar = document.getElementById('mini-player-bar');
        const miniAlbumArt = document.getElementById('mini-album-art');
        const miniSongTitle = document.getElementById('mini-song-title');
        const miniSongArtist = document.getElementById('mini-song-artist');
        const miniPlayPauseButton = document.getElementById('mini-play-pause-button');
        
        const fullscreenPlayer = document.getElementById('fullscreen-player');
        const fullAlbumArt = document.getElementById('full-album-art');
        const fullSongTitle = document.getElementById('full-song-title');
        const fullSongArtist = document.getElementById('full-song-artist');
        const fullPlayPauseButton = document.getElementById('full-play-pause-button');
        const fullProgressBar = document.getElementById('full-progress-fill');
        const fullCurrentTime = document.getElementById('full-current-time');
        const fullTotalTime = document.getElementById('full-total-time');
        const fullPlayerBackButton = document.getElementById('full-player-back-button');
        
        const audioPlayer = document.getElementById('audio-player');

        const homeNavLink = document.getElementById('home-nav-link');
        const searchNavLink = document.getElementById('search-nav-link');
        const libraryNavLink = document.getElementById('library-nav-link');

        let currentSong = null;

        function showSection(section) {
            homeSection.classList.add('hidden');
            searchSection.classList.add('hidden');
            fullscreenPlayer.classList.add('hidden');
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));

            if (section === 'home') {
                homeSection.classList.remove('hidden');
                homeNavLink.classList.add('active');
            } else if (section === 'search') {
                searchSection.classList.remove('hidden');
                searchNavLink.classList.add('active');
            } else if (section === 'fullscreen') {
                fullscreenPlayer.classList.remove('hidden');
                miniPlayerBar.classList.add('hidden');
            } else if (section === 'library') {
                alert('Your Library functionality is not yet implemented.');
                homeSection.classList.remove('hidden');
                homeNavLink.classList.add('active');
            }
        }

        function createCard(title, subtitle, imageUrl, onClickHandler) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${imageUrl}" alt="${title}">
                <div class="title">${title}</div>
                <div class="subtitle">${subtitle}</div>
            `;
            card.onclick = onClickHandler;
            return card;
        }

        async function playSong(song) {
            currentSong = song;

            miniAlbumArt.src = song.thumbnail;
            miniSongTitle.textContent = song.title;
            miniSongArtist.textContent = song.artist;
            miniPlayerBar.classList.remove('hidden');

            fullAlbumArt.src = song.thumbnail;
            fullSongTitle.textContent = song.title;
            fullSongArtist.textContent = song.artist;
            
            try {
                const response = await fetch(`/audio-link-api?id=${song.id}`);
                const data = await response.json();
                if (response.ok && data.audioUrl) {
                    audioPlayer.src = data.audioUrl;
                    audioPlayer.play();
                    updatePlayPauseButtons(true);
                } else {
                    console.error("Failed to fetch audio URL:", data.error);
                    alert("Error playing song. The audio URL could not be fetched.");
                    updatePlayPauseButtons(false);
                }
            } catch (error) {
                console.error("An error occurred:", error);
                alert("An error occurred. Please try again later.");
                updatePlayPauseButtons(false);
            }
        }
        
        function updatePlayPauseButtons(isPlaying) {
            if (isPlaying) {
                miniPlayPauseButton.textContent = '‚è∏';
                fullPlayPauseButton.textContent = '‚è∏';
            } else {
                miniPlayPauseButton.textContent = '‚ñ∂';
                fullPlayPauseButton.textContent = '‚ñ∂';
            }
        }
        
        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
            updatePlayPauseButtons(!audioPlayer.paused);
        }

        homeNavLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('home');
        });

        searchNavLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('search');
        });
        
        libraryNavLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('library');
        });

        searchButton.addEventListener('click', async () => {
            const query = searchInput.value;
            if (query.trim() === '') return;

            searchResultsGrid.innerHTML = '<p style="text-align: center;">Searching...</p>';
            
            try {
                const response = await fetch(`/search-api?q=${encodeURIComponent(query)}`);
                const videos = await response.json();
                
                searchResultsGrid.innerHTML = '';
                if (videos.length === 0) {
                    searchResultsGrid.innerHTML = '<p style="text-align: center;">No songs found.</p>';
                } else {
                    videos.forEach(video => {
                        const song = {
                            id: video.id,
                            title: video.title,
                            artist: video.author.name,
                            thumbnail: video.thumbnail
                        };
                        const card = createCard(song.title, song.artist, song.thumbnail, () => playSong(song));
                        searchResultsGrid.appendChild(card);
                    });
                }
            } catch (error) {
                console.error("Search failed:", error);
                searchResultsGrid.innerHTML = '<p style="text-align: center; color: red;">Failed to load search results. Please try again later.</p>';
            }
        });

        miniPlayerBar.addEventListener('click', () => {
            showSection('fullscreen');
        });
        
        miniPlayPauseButton.addEventListener('click', (e) => {
            e.stopPropagation();
            togglePlayPause();
        });
        
        fullPlayerBackButton.addEventListener('click', () => {
            if (!homeSection.classList.contains('hidden')) {
                showSection('home');
            } else {
                showSection('search');
            }
            miniPlayerBar.classList.remove('hidden');
        });
        
        fullPlayPauseButton.addEventListener('click', () => {
            togglePlayPause();
        });
        
        audioPlayer.addEventListener('timeupdate', () => {
            const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            fullProgressBar.style.width = `${progress}%`;
            fullCurrentTime.textContent = formatTime(audioPlayer.currentTime);
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            fullTotalTime.textContent = formatTime(audioPlayer.duration);
        });

        audioPlayer.addEventListener('ended', () => {
            updatePlayPauseButtons(false);
            fullProgressBar.style.width = '0%';
            fullCurrentTime.textContent = '0:00';
        });

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        const dummyCategories = [
            { name: "Bangla Rock", imageUrl: "https://i.imgur.com/Gz4Bq1r.jpg" },
            { name: "Hot Hits Bangladesh", imageUrl: "https://i.imgur.com/8Qp4Z01.jpg" },
            { name: "Bangla Pop", imageUrl: "https://i.imgur.com/i9TzT7A.jpg" },
            { name: "Bangla Folk", imageUrl: "https://i.imgur.com/9C7Bq3s.jpg" },
        ];
        
        const dummyMixes = [
            { title: "HIGHWAY Mix", artist: "Odd Signature, Aftermath", imageUrl: "https://i.imgur.com/2s45x5C.jpg" },
            { title: "Karnival Mix", artist: "HIGHWAY, Aftermath", imageUrl: "https://i.imgur.com/K3t8rP8.jpg" },
        ];

        document.addEventListener('DOMContentLoaded', () => {
            dummyCategories.forEach(cat => {
                const card = createCard(cat.name, "Playlist", cat.imageUrl, () => alert(`Playing category: ${cat.name}`));
                categoryGrid.appendChild(card);
            });
            dummyMixes.forEach(mix => {
                const card = createCard(mix.title, mix.artist, mix.imageUrl, () => alert(`Playing mix: ${mix.title}`));
                mixesGrid.appendChild(card);
            });
            showSection('home');
        });
    </script>
</body>
</html>