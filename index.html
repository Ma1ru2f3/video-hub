<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ভিডিও হাব</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .video-container, .audio-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .video-container iframe, .audio-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen p-4 flex flex-col items-center">

    <div class="container mx-auto p-4 md:p-8 w-full max-w-4xl">
        <!-- Title and Search Bar -->
        <h1 class="text-4xl md:text-5xl font-extrabold text-center text-indigo-600 mb-6">ভিডিও হাব</h1>

        <div class="flex items-center space-x-2 md:space-x-4 mb-8">
            <input type="text" id="searchInput" placeholder="ভিডিও বা গান খুঁজুন..."
                   class="w-full p-3 md:p-4 rounded-full border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 shadow-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100">
            <button id="searchButton"
                    class="p-3 md:p-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-full shadow-lg transition-transform transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </button>
        </div>

        <!-- Search Mode Toggles -->
        <div class="flex justify-center mb-6 space-x-4">
            <button id="videoModeBtn" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">ভিডিও</button>
            <button id="audioModeBtn" class="bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded-full shadow-lg transition-transform transform hover:scale-105">অডিও</button>
        </div>

        <!-- Audio Player Section -->
        <div id="audioPlayerSection" class="w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 mb-8 hidden">
            <audio id="audioPlayer" controls class="w-full"></audio>
            <h2 id="audioTitle" class="text-xl md:text-2xl font-semibold mt-4 text-center"></h2>
        </div>

        <!-- Main Content Area -->
        <div id="contentContainer" class="w-full">
            <div id="loadingIndicator" class="text-center text-lg hidden">লোড হচ্ছে...</div>
            <div id="resultsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Results will be injected here -->
            </div>
            <p id="noResultsMessage" class="text-center text-gray-500 hidden mt-4">কোনো ফলাফল পাওয়া যায়নি।</p>
        </div>
    </div>

    <!-- JavaScript to handle fetching and displaying data -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const videoModeBtn = document.getElementById('videoModeBtn');
            const audioModeBtn = document.getElementById('audioModeBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsGrid = document.getElementById('resultsGrid');
            const noResultsMessage = document.getElementById('noResultsMessage');
            const audioPlayerSection = document.getElementById('audioPlayerSection');
            const audioPlayer = document.getElementById('audioPlayer');
            const audioTitle = document.getElementById('audioTitle');
            
            let currentMode = 'video';

            // Function to show and hide elements
            const showElement = (element) => element.classList.remove('hidden');
            const hideElement = (element) => element.classList.add('hidden');

            // Toggle search modes
            const setMode = (mode) => {
                currentMode = mode;
                if (mode === 'video') {
                    videoModeBtn.classList.replace('bg-gray-300', 'bg-indigo-600');
                    videoModeBtn.classList.replace('text-gray-800', 'text-white');
                    audioModeBtn.classList.replace('bg-indigo-600', 'bg-gray-300');
                    audioModeBtn.classList.replace('text-white', 'text-gray-800');
                    searchInput.placeholder = 'ভিডিও খুঁজুন...';
                    hideElement(audioPlayerSection);
                } else { // audio
                    audioModeBtn.classList.replace('bg-gray-300', 'bg-indigo-600');
                    audioModeBtn.classList.replace('text-gray-800', 'text-white');
                    videoModeBtn.classList.replace('bg-indigo-600', 'bg-gray-300');
                    videoModeBtn.classList.replace('text-white', 'text-gray-800');
                    searchInput.placeholder = 'গান খুঁজুন...';
                }
                fetchTrending();
            };

            // Create a video card
            const createVideoCard = (video) => {
                const card = document.createElement('div');
                card.classList.add('bg-white', 'dark:bg-gray-800', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'cursor-pointer', 'transition-transform', 'transform', 'hover:scale-105');
                card.innerHTML = `
                    <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-40 object-cover">
                    <div class="p-3">
                        <h3 class="text-sm font-semibold truncate mb-1" title="${video.title}">${video.title}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400">by ${video.author}</p>
                    </div>
                `;
                card.onclick = () => {
                    // This section will need to be implemented on the video-play page
                    // For now, it will not do anything.
                    console.log(`Playing video with ID: ${video.videoId}`);
                    alert('ভিডিও প্লে করার ফিচারটি এই সংস্করণে নেই।');
                };
                return card;
            };

            // Create an audio card
            const createAudioCard = (audio) => {
                const card = document.createElement('div');
                card.classList.add('bg-white', 'dark:bg-gray-800', 'rounded-lg', 'shadow-md', 'p-3', 'cursor-pointer', 'transition-transform', 'transform', 'hover:scale-105');
                card.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19H3v-7h6M21 16V6M9 19c-3.111 0-5.875-1.92-7-5.5a9.542 9.542 0 00-1-2.5" />
                        </svg>
                        <div class="flex-grow">
                            <h3 class="text-sm font-semibold truncate" title="${audio.title}">${audio.title}</h3>
                            <p class="text-xs text-gray-500 dark:text-gray-400">by ${audio.author}</p>
                        </div>
                    </div>
                `;
                card.onclick = () => playAudio(audio.videoId, audio.title);
                return card;
            };

            // Fetch and display trending items
            const fetchTrending = async () => {
                showElement(loadingIndicator);
                hideElement(resultsGrid);
                hideElement(noResultsMessage);

                let apiUrl = '/home-api';
                if (currentMode === 'audio') {
                    apiUrl = '/audio-search-api'; // Assumes this endpoint works like home-api
                }

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const results = await response.json();
                    
                    resultsGrid.innerHTML = '';
                    if (results.length > 0) {
                        results.forEach(item => {
                            if (currentMode === 'video') {
                                resultsGrid.appendChild(createVideoCard(item));
                            } else {
                                resultsGrid.appendChild(createAudioCard(item));
                            }
                        });
                        showElement(resultsGrid);
                    } else {
                        showElement(noResultsMessage);
                    }
                } catch (error) {
                    console.error('Error fetching trending items:', error);
                    noResultsMessage.textContent = 'লোড করতে ব্যর্থ হয়েছে।';
                    showElement(noResultsMessage);
                } finally {
                    hideElement(loadingIndicator);
                }
            };

            // Handle search
            const handleSearch = async () => {
                const query = searchInput.value.trim();
                if (query === '') return;

                showElement(loadingIndicator);
                hideElement(resultsGrid);
                hideElement(noResultsMessage);
                
                let apiUrl = `/search-api?q=${encodeURIComponent(query)}`;
                if (currentMode === 'audio') {
                    apiUrl = `/audio-search-api?q=${encodeURIComponent(query)}`;
                }
                
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Search failed');
                    const results = await response.json();

                    resultsGrid.innerHTML = '';
                    if (results.length > 0) {
                        results.forEach(item => {
                            if (currentMode === 'video') {
                                resultsGrid.appendChild(createVideoCard(item));
                            } else {
                                resultsGrid.appendChild(createAudioCard(item));
                            }
                        });
                        showElement(resultsGrid);
                    } else {
                        showElement(noResultsMessage);
                    }
                } catch (error) {
                    console.error('Search error:', error);
                    noResultsMessage.textContent = 'সার্চ করতে ব্যর্থ হয়েছে।';
                    showElement(noResultsMessage);
                } finally {
                    hideElement(loadingIndicator);
                }
            };

            // Play audio and show player section
            const playAudio = async (videoId, title) => {
                showElement(loadingIndicator);
                hideElement(resultsGrid);
                hideElement(noResultsMessage);
                
                try {
                    const audioLinkResponse = await fetch(`/audio-link-api?id=${encodeURIComponent(videoId)}`);
                    if (!audioLinkResponse.ok) throw new Error('Failed to get audio link');
                    const audioData = await audioLinkResponse.json();
                    
                    audioPlayer.src = audioData.audioUrl;
                    audioTitle.textContent = title;
                    audioPlayer.play();
                    showElement(audioPlayerSection);
                } catch (error) {
                    console.error('Error playing audio:', error);
                    noResultsMessage.textContent = 'গানটি প্লে করতে ব্যর্থ হয়েছে।';
                    showElement(noResultsMessage);
                    hideElement(loadingIndicator);
                } finally {
                    hideElement(loadingIndicator);
                }
            };

            // Event Listeners
            searchButton.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            videoModeBtn.addEventListener('click', () => setMode('video'));
            audioModeBtn.addEventListener('click', () => setMode('audio'));

            // Initial load
            fetchTrending();
        });
    </script>

</body>
</html>